<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alerts | CICS AlertSOS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
</head>

<body class="bg-gray-100 font-sans">
  <!-- Navbar (always on top) -->
  <custom-navbar class="relative z-50"></custom-navbar>

  <!-- Sidebar (below navbar) -->
  <custom-sidebar class="relative z-40"></custom-sidebar>

  <!-- Main Content -->
  <main class="pt-[6rem] lg:pt-[7rem] p-4 sm:p-6 md:p-8 transition-all duration-300 lg:ml-64 min-h-screen">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6">
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 text-center sm:text-left">Emergency Alerts</h1>

      <!-- Filter Buttons -->
      <div class="flex flex-wrap justify-center sm:justify-end gap-2">
        <button class="filter-btn bg-red-600 text-white px-4 py-2 rounded-lg font-medium" data-priority="All">All</button>
        <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium" data-priority="High">High</button>
        <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium" data-priority="Medium">Medium</button>
        <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium" data-priority="Low">Low</button>
      </div>
    </div>

    <!-- Alerts Container -->
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
      <div class="p-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 border-b">
        <h2 class="text-lg sm:text-xl font-semibold text-gray-800">Recent Alerts</h2>
        <select id="sortSelect" class="border-gray-300 border px-3 py-2 rounded-lg text-sm w-full sm:w-auto">
          <option value="date-desc">Newest First</option>
          <option value="date-asc">Oldest First</option>
          <option value="priority-high">High Priority First</option>
          <option value="priority-low">Low Priority First</option>
        </select>
      </div>

      <!-- Table for Desktop -->
      <div class="hidden sm:block overflow-x-auto">
        <table class="w-full text-left border-collapse">
          <thead class="bg-gray-100 text-gray-600 text-sm uppercase">
            <tr>
              <th class="py-3 px-4">Alert ID</th>
              <th class="py-3 px-4">Message</th>
              <th class="py-3 px-4">Priority</th>
              <th class="py-3 px-4">Date</th>
              <th class="py-3 px-4 text-center">Status</th>
            </tr>
          </thead>
          <tbody id="alertsBody" class="text-gray-800">
            <tr data-priority="High">
              <td class="py-3 px-4 font-medium">A001</td>
              <td class="py-3 px-4">Fire reported near CICS building.</td>
              <td class="py-3 px-4 text-red-600 font-semibold">High</td>
              <td class="py-3 px-4" data-date="2025-10-21T09:00:00">Oct 21, 2025</td>
              <td class="py-3 px-4 text-center"><span class="bg-red-100 text-red-700 px-2 py-1 rounded-full text-sm">Active</span></td>
            </tr>
            <tr data-priority="Medium">
              <td class="py-3 px-4 font-medium">A002</td>
              <td class="py-3 px-4">Scheduled maintenance on power lines.</td>
              <td class="py-3 px-4 text-yellow-600 font-semibold">Medium</td>
              <td class="py-3 px-4" data-date="2025-10-20T14:30:00">Oct 20, 2025</td>
              <td class="py-3 px-4 text-center"><span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded-full text-sm">Ongoing</span></td>
            </tr>
            <tr data-priority="Low">
              <td class="py-3 px-4 font-medium">A003</td>
              <td class="py-3 px-4">Weather advisory: light rain expected.</td>
              <td class="py-3 px-4 text-green-600 font-semibold">Low</td>
              <td class="py-3 px-4" data-date="2025-10-19T08:00:00">Oct 19, 2025</td>
              <td class="py-3 px-4 text-center"><span class="bg-green-100 text-green-700 px-2 py-1 rounded-full text-sm">Resolved</span></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Card Layout for Mobile -->
      <div id="alertsCards" class="sm:hidden grid grid-cols-1 gap-4 p-4 text-gray-800">
        <div data-priority="High" class="bg-red-50 border border-red-200 rounded-xl p-4 shadow-sm">
          <div class="flex justify-between items-center">
            <h3 class="font-semibold text-lg text-red-700">A001</h3>
            <span class="bg-red-100 text-red-700 px-2 py-1 rounded-full text-xs">Active</span>
          </div>
          <p class="mt-2 text-sm">Fire reported near CICS building.</p>
          <div class="mt-3 text-sm">
            <span class="font-semibold text-red-600">High Priority</span><br>
            <span class="text-gray-600">Date: Oct 21, 2025</span>
          </div>
        </div>

        <div data-priority="Medium" class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 shadow-sm">
          <div class="flex justify-between items-center">
            <h3 class="font-semibold text-lg text-yellow-700">A002</h3>
            <span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded-full text-xs">Ongoing</span>
          </div>
          <p class="mt-2 text-sm">Scheduled maintenance on power lines.</p>
          <div class="mt-3 text-sm">
            <span class="font-semibold text-yellow-600">Medium Priority</span><br>
            <span class="text-gray-600">Date: Oct 20, 2025</span>
          </div>
        </div>

        <div data-priority="Low" class="bg-green-50 border border-green-200 rounded-xl p-4 shadow-sm">
          <div class="flex justify-between items-center">
            <h3 class="font-semibold text-lg text-green-700">A003</h3>
            <span class="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs">Resolved</span>
          </div>
          <p class="mt-2 text-sm">Weather advisory: light rain expected.</p>
          <div class="mt-3 text-sm">
            <span class="font-semibold text-green-600">Low Priority</span><br>
            <span class="text-gray-600">Date: Oct 19, 2025</span>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Overlay (for mobile sidebar) -->
  <div id="overlay" class="fixed inset-0 bg-black bg-opacity-40 hidden z-40"></div>

  <!-- JS Logic -->
  <script src="components/navbar.js"></script>
  <script src="components/sidebar.js"></script>

  <script>
    feather.replace();

    // === Filtering ===
    const filterButtons = document.querySelectorAll(".filter-btn");
    const tableRows = document.querySelectorAll("#alertsBody tr");
    const cardAlerts = document.querySelectorAll("#alertsCards > div");

    filterButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        filterButtons.forEach(b => b.classList.remove("bg-red-600", "text-white"));
        filterButtons.forEach(b => b.classList.add("bg-gray-200", "text-gray-700"));

        btn.classList.add("bg-red-600", "text-white");
        btn.classList.remove("bg-gray-200", "text-gray-700");

        const priority = btn.dataset.priority;
        [...tableRows, ...cardAlerts].forEach(item => {
          item.style.display = (priority === "All" || item.dataset.priority === priority) ? "" : "none";
        });
      });
    });

    // === Sorting ===
    const sortSelect = document.getElementById("sortSelect");
    const tbody = document.getElementById("alertsBody");
    const priorityOrder = { High: 3, Medium: 2, Low: 1 };

    sortSelect.addEventListener("change", () => {
      const rowsArray = Array.from(tbody.querySelectorAll("tr"));
      const value = sortSelect.value;

      rowsArray.sort((a, b) => {
        if (value.includes("date")) {
          const dateA = new Date(a.querySelector("[data-date]").dataset.date);
          const dateB = new Date(b.querySelector("[data-date]").dataset.date);
          return value === "date-asc" ? dateA - dateB : dateB - dateA;
        } else if (value === "priority-high") {
          return priorityOrder[b.dataset.priority] - priorityOrder[a.dataset.priority];
        } else if (value === "priority-low") {
          return priorityOrder[a.dataset.priority] - priorityOrder[b.dataset.priority];
        }
      });

      rowsArray.forEach(row => tbody.appendChild(row));
    });

    // === Mobile Sidebar Toggle ===
    document.addEventListener("DOMContentLoaded", () => {
      const navbar = document.querySelector("custom-navbar");
      const sidebar = document.querySelector("custom-sidebar");
      const overlay = document.getElementById("overlay");

      setTimeout(() => {
        const navShadow = navbar.shadowRoot;
        const sidebarShadow = sidebar.shadowRoot;
        const menuButton = navShadow.getElementById("mobile-menu-button");
        const sidebarElement = sidebarShadow.getElementById("sidebar");

        sidebarElement.classList.add("transition-transform", "duration-300", "transform", "-translate-x-full");

        menuButton.addEventListener("click", () => {
          const isOpen = sidebarElement.classList.contains("translate-x-0");
          sidebarElement.classList.toggle("-translate-x-full", isOpen);
          sidebarElement.classList.toggle("translate-x-0", !isOpen);
          overlay.classList.toggle("hidden", isOpen);
        });

        overlay.addEventListener("click", () => {
          sidebarElement.classList.add("-translate-x-full");
          overlay.classList.add("hidden");
        });

        const menuItems = sidebarShadow.querySelectorAll(".menu-item");
        menuItems.forEach(item => {
          item.addEventListener("click", () => {
            if (window.innerWidth <= 768) {
              sidebarElement.classList.add("-translate-x-full");
              overlay.classList.add("hidden");
            }
          });
        });
      }, 300);
    });
  </script>
</body>
</html>
