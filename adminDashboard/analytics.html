<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin Analytics | CICS AlertSOS</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- jsPDF & XLSX -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://unpkg.com/feather-icons"></script>

<style>
  body {
    font-family: 'Inter', sans-serif;
    background-color: #f9fafb;
  }
  .dashboard-card {
    background-color: #fff;
    border-radius: 1rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    transition: 0.3s;
  }
  .dashboard-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
  }
  #acknowledgmentChart {
    width: 100%;
    height: 250px;
  }
</style>
</head>

<body class="bg-gray-100 font-sans">
  <!-- Navbar -->
  <custom-navbar class="relative z-50"></custom-navbar>

  <!-- Sidebar -->
  <custom-sidebar class="relative z-40"></custom-sidebar>

  <main class="pt-20 lg:pt-24 p-4 lg:ml-64 min-h-screen transition-all duration-300">
    <h1 class="text-2xl sm:text-3xl font-bold mb-6 text-gray-800">Analytics Dashboard</h1>

    <section class="grid grid-cols-1 lg:grid-cols-2 gap-8">

      <!-- Alert Activity -->
      <div class="dashboard-card p-6 relative">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold text-red-700">Alert Activity</h3>
          <div class="flex space-x-2">
            <button class="text-xs px-2 py-1 bg-red-100 text-red-700 rounded-lg">Daily</button>
            <button class="text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded-lg">Weekly</button>
            <button class="text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded-lg">Monthly</button>
          </div>
        </div>
        <div class="flex justify-end mb-3 space-x-2">
          <button class="btn btn-sm btn-outline-danger" onclick="exportToExcel()">Excel</button>
          <button class="btn btn-sm btn-outline-danger" onclick="exportToPDF()">PDF</button>
        </div>
        <div class="h-80">
          <canvas id="alertChart"></canvas>
        </div>
      </div>

      <!-- Acknowledgment Rate -->
      <div class="dashboard-card p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold text-red-700">Acknowledgment Rate</h3>
          <div class="flex space-x-2">
            <button class="btn btn-sm btn-outline-danger" onclick="exportAckExcel()">Excel</button>
            <button class="btn btn-sm btn-outline-danger" onclick="exportAckPDF()">PDF</button>
          </div>
        </div>
        <div class="h-64 relative">
          <canvas id="acknowledgmentChart"></canvas>
          <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center">
            <p class="text-4xl font-bold text-gray-800" id="ackRateText">0%</p>
            <p class="text-gray-500 text-sm mt-1">Acknowledgment Rate</p>
          </div>
        </div>
      </div>

    </section>
  </main>

<script src="components/navbar.js"></script>
<script src="components/sidebar.js"></script>

<script>
feather.replace();

/* ===== ALERT ACTIVITY CHART ===== */
const ctx = document.getElementById('alertChart');
new Chart(ctx, {
  type: 'line',
  data: {
    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
    datasets: [
      {
        label: 'Alerts Sent',
        data: [12, 19, 3, 5, 2, 3],
        borderColor: '#dc2626',
        backgroundColor: 'rgba(220,38,38,0.1)',
        tension: 0.4,
        borderWidth: 3
      },
      {
        label: 'Acknowledged',
        data: [10, 15, 2, 4, 1, 2],
        borderColor: '#16a34a',
        backgroundColor: 'rgba(22,163,74,0.1)',
        tension: 0.4,
        borderWidth: 3
      }
    ]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { position: 'top' },
    },
    scales: {
      y: { beginAtZero: true }
    }
  }
});

/* ===== SEGMENTED ACKNOWLEDGMENT RATE GAUGE ===== */
const gauge = document.getElementById('acknowledgmentChart');
const gaugeCtx = gauge.getContext('2d');
const target = 76; // target rate %
let current = 0;

function drawGauge(percentage) {
  const centerX = gauge.width / 2;
  const centerY = gauge.height * 0.9;
  const radius = 90;
  const startAngle = Math.PI;
  const segments = 50;
  const gap = Math.PI / (segments * 5);

  gaugeCtx.clearRect(0, 0, gauge.width, gauge.height);

  for (let i = 0; i < segments; i++) {
    const angleStart = startAngle + i * (Math.PI / segments);
    const angleEnd = angleStart + (Math.PI / segments) - gap;
    gaugeCtx.beginPath();
    gaugeCtx.arc(centerX, centerY, radius, angleStart, angleEnd);
    gaugeCtx.lineWidth = 10;
    gaugeCtx.strokeStyle = i / segments < percentage / 100 ? '#dc2626' : '#e5e7eb';
    gaugeCtx.stroke();
  }

  document.getElementById('ackRateText').innerText = percentage + '%';
}

const anim = setInterval(() => {
  if (current < target) {
    current++;
    drawGauge(current);
  } else clearInterval(anim);
}, 20);

/* ===== EXPORT FUNCTIONS ===== */
function exportToExcel() {
  const data = [
    ['Month', 'Alerts Sent', 'Acknowledged'],
    ['Jan', 12, 10],
    ['Feb', 19, 15],
    ['Mar', 3, 2],
    ['Apr', 5, 4],
    ['May', 2, 1],
    ['Jun', 3, 2]
  ];
  const ws = XLSX.utils.aoa_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Alert Data');
  XLSX.writeFile(wb, 'Alert_Activity.xlsx');
}

function exportToPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("Alert Activity Report", 14, 20);
  doc.autoTable({
    startY: 30,
    head: [['Month', 'Alerts Sent', 'Acknowledged']],
    body: [
      ['Jan', 12, 10],
      ['Feb', 19, 15],
      ['Mar', 3, 2],
      ['Apr', 5, 4],
      ['May', 2, 1],
      ['Jun', 3, 2]
    ]
  });
  doc.save('Alert_Activity_Report.pdf');
}

function exportAckExcel() {
  const ws = XLSX.utils.aoa_to_sheet([['Metric', 'Value'], ['Acknowledgment Rate', target + '%']]);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Ack Rate');
  XLSX.writeFile(wb, 'Acknowledgment_Rate.xlsx');
}

function exportAckPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("Acknowledgment Rate Report", 14, 20);
  doc.autoTable({
    startY: 30,
    head: [['Metric', 'Value']],
    body: [['Acknowledgment Rate', target + '%']]
  });
  doc.save('Acknowledgment_Rate_Report.pdf');
}
</script>
</body>
</html>
